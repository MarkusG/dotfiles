#!/bin/bash
# upload screencast and clean up

# kill ffmpeg and delete the file we use to keep track of its PID
ffmpeg_id=$(cat /tmp/screencast_pid)
kill -2 $ffmpeg_id
rm /tmp/screencast_pid

# upload screencast to nixne.st
# get key from gfycat
key=$(curl -XPOST https://api.gfycat.com/v1/gfycats -H "Content-Type: application/json")
gfyname=$(echo $key | jq '.gfyname' | tr -d '"')

# rename file to match the name gfycat gave us
mv /tmp/screencast.mp4 /tmp/$gfyname

# upload
curl -i https://filedrop.gfycat.com --upload-file /tmp/$gfyname

# copy url and notify
echo "https://giant.gfycat.com/$gfyname.mp4" | xsel -b
notify-send -t 1000 'Screencast uploaded.' -i '/usr/share/icons/Arc/apps/symbolic/applets-screenshooter-symbolic.svg'
